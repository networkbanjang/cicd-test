name: ssh-test

on: 
  push: 
    branches: [ "main" ]

jobs: 
  build:
    name: Build
    runs-on: [self-hosted, linux, x64]

    steps:
      - name: Checkout repository
        uses: actions/checkout@v3
      - name: today_data_dump
        run: export date=$(date "+%Y%m%d")
             mysqldump -u root -p temp > /home/test/${date}_backup.sql 
      - name: S3 sync 
        env:
          AWS_ACCESS_KEY_ID: ${{ secrets.AWS_ACCESS_KEY }}
          AWS_SECRET_ACCESS_KEY: ${{ secrets.AWS_SECRET_KEY }}
        run: |
          aws s3 sync ./build s3://s3backup-test
      - name: End
        run: rm -f /home/test/${date}_backup.sql
